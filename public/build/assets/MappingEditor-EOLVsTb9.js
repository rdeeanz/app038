import{S as fe,i as de,s as pe,d as A,a as ce,t as me,b as ge,c as C,m as be,e as T,f as _e,o as ye,p as te,q as he,g as J,h as i,v as z,j as u,k as I,l as f,N as ve,u as Me,r as ue,w as le}from"./app-BhE3jarQ.js";import{A as xe}from"./AppLayout-BfVQ8FrY.js";import{a as G}from"./api-BX241UDV.js";function ne(l,t,e){const n=l.slice();return n[20]=t[e],n}function se(l){let t,e;return{c(){t=u("div"),e=I(l[6]),f(t,"class","mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded")},m(n,r){C(n,t,r),i(t,e)},p(n,r){r&64&&J(e,n[6])},d(n){n&&A(t)}}}function ae(l){let t,e;return{c(){t=u("div"),e=I(l[7]),f(t,"class","mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded")},m(n,r){C(n,t,r),i(t,e)},p(n,r){r&128&&J(e,n[7])},d(n){n&&A(t)}}}function ie(l){let t,e=l[20]+"",n,r,s,p,d;function b(){return l[16](l[20])}return{c(){t=u("button"),n=I(e),r=T(),f(t,"class",s="w-full text-left px-3 py-2 text-sm rounded-md "+(l[3]===l[20]?"bg-blue-50 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-50"))},m(m,_){C(m,t,_),i(t,n),i(t,r),p||(d=z(t,"click",b),p=!0)},p(m,_){l=m,_&2&&e!==(e=l[20]+"")&&J(n,e),_&10&&s!==(s="w-full text-left px-3 py-2 text-sm rounded-md "+(l[3]===l[20]?"bg-blue-50 text-blue-700 font-medium":"text-gray-700 hover:bg-gray-50"))&&f(t,"class",s)},d(m){m&&A(t),p=!1,d()}}}function re(l){let t;return{c(){t=u("p"),t.textContent="Edit YAML mapping configuration",f(t,"class","text-sm text-gray-500 mt-1")},m(e,n){C(e,t,n)},d(e){e&&A(t)}}}function oe(l){let t,e,n,r,s,p=l[5]?"Saving...":"Save",d,b,m,_;return{c(){t=u("button"),e=I("Test Mapping"),r=T(),s=u("button"),d=I(p),t.disabled=n=l[4]||l[5],f(t,"class","px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 disabled:opacity-50"),s.disabled=b=l[4]||l[5],f(s,"class","px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50")},m(c,M){C(c,t,M),i(t,e),C(c,r,M),C(c,s,M),i(s,d),m||(_=[z(t,"click",l[11]),z(s,"click",l[9])],m=!0)},p(c,M){M&48&&n!==(n=c[4]||c[5])&&(t.disabled=n),M&32&&p!==(p=c[5]?"Saving...":"Save")&&J(d,p),M&48&&b!==(b=c[4]||c[5])&&(s.disabled=b)},d(c){c&&(A(t),A(r),A(s)),m=!1,Me(_)}}}function ke(l){let t;return{c(){t=u("div"),t.innerHTML="<p>Select a mapping file from the sidebar to start editing</p>",f(t,"class","text-center py-12 text-gray-500")},m(e,n){C(e,t,n)},p:ue,d(e){e&&A(t)}}}function we(l){let t,e,n,r,s,p;return{c(){t=u("div"),e=u("textarea"),n=T(),r=u("div"),r.innerHTML='<h4 class="text-sm font-medium text-gray-900 mb-2">YAML Mapping Syntax</h4> <ul class="text-xs text-gray-600 space-y-1 list-disc list-inside"><li>Use <code class="bg-gray-200 px-1 rounded">source</code> to map from source field</li> <li>Use <code class="bg-gray-200 px-1 rounded">transform</code> for data transformation</li> <li>Use <code class="bg-gray-200 px-1 rounded">default</code> for default values</li> <li>Use <code class="bg-gray-200 px-1 rounded">required: true</code> for required fields</li></ul>',f(e,"class","w-full h-96 p-4 font-mono text-sm border-0 focus:ring-0 focus:outline-none resize-none"),f(e,"placeholder","Enter YAML mapping configuration..."),f(t,"class","border border-gray-300 rounded-md"),f(r,"class","mt-4 p-4 bg-gray-50 rounded-md")},m(d,b){C(d,t,b),i(t,e),le(e,l[2]),C(d,n,b),C(d,r,b),s||(p=z(e,"input",l[17]),s=!0)},p(d,b){b&4&&le(e,d[2])},d(d){d&&(A(t),A(n),A(r)),s=!1,p()}}}function Se(l){let t;return{c(){t=u("div"),t.innerHTML='<div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div> <p class="mt-2 text-sm text-gray-500">Loading mapping file...</p>',f(t,"class","text-center py-12")},m(e,n){C(e,t,n)},p:ue,d(e){e&&A(t)}}}function Le(l){let t,e,n,r,s,p,d,b,m,_,c,M,g,q,O,H,W,j,D,N,U,a,x,h=(l[3]||"Select a mapping file")+"",y,Q,V,R,X,K,Z,w=l[6]&&se(l),S=l[7]&&ae(l),P=te(l[1]),k=[];for(let o=0;o<P.length;o+=1)k[o]=ie(ne(l,P,o));let F=l[3]&&re(),L=l[3]&&oe(l);function $(o,Y){return o[4]?Se:o[3]?we:ke}let B=$(l),E=B(l);return{c(){t=u("div"),e=u("div"),n=u("div"),r=u("div"),r.innerHTML='<h1 class="text-3xl font-bold text-gray-900">Mapping Editor</h1> <p class="mt-2 text-sm text-gray-600">Edit YAML mapping files for SAP data transformation</p>',s=T(),p=u("div"),d=u("button"),d.textContent="New Mapping",b=T(),w&&w.c(),m=T(),S&&S.c(),_=T(),c=u("div"),M=u("div"),g=u("div"),q=u("h3"),q.textContent="Mapping Files",O=T(),H=u("div");for(let o=0;o<k.length;o+=1)k[o].c();W=T(),j=u("div"),D=u("div"),N=u("div"),U=u("div"),a=u("div"),x=u("h3"),y=I(h),Q=T(),F&&F.c(),V=T(),R=u("div"),L&&L.c(),X=T(),E.c(),f(d,"class","px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700"),f(p,"class","flex space-x-2"),f(n,"class","mb-8 flex justify-between items-center"),f(q,"class","text-sm font-medium text-gray-900 mb-4"),f(H,"class","space-y-2"),f(g,"class","bg-white shadow rounded-lg p-4"),f(M,"class","lg:col-span-1"),f(x,"class","text-lg font-medium text-gray-900"),f(R,"class","flex space-x-2"),f(U,"class","mb-4 flex justify-between items-center"),f(N,"class","px-4 py-5 sm:p-6"),f(D,"class","bg-white shadow rounded-lg"),f(j,"class","lg:col-span-3"),f(c,"class","grid grid-cols-1 lg:grid-cols-4 gap-6"),f(e,"class","max-w-7xl mx-auto sm:px-6 lg:px-8"),f(t,"class","py-12")},m(o,Y){C(o,t,Y),i(t,e),i(e,n),i(n,r),i(n,s),i(n,p),i(p,d),i(e,b),w&&w.m(e,null),i(e,m),S&&S.m(e,null),i(e,_),i(e,c),i(c,M),i(M,g),i(g,q),i(g,O),i(g,H);for(let v=0;v<k.length;v+=1)k[v]&&k[v].m(H,null);i(c,W),i(c,j),i(j,D),i(D,N),i(N,U),i(U,a),i(a,x),i(x,y),i(a,Q),F&&F.m(a,null),i(U,V),i(U,R),L&&L.m(R,null),i(N,X),E.m(N,null),K||(Z=z(d,"click",l[10]),K=!0)},p(o,Y){if(o[6]?w?w.p(o,Y):(w=se(o),w.c(),w.m(e,m)):w&&(w.d(1),w=null),o[7]?S?S.p(o,Y):(S=ae(o),S.c(),S.m(e,_)):S&&(S.d(1),S=null),Y&266){P=te(o[1]);let v;for(v=0;v<P.length;v+=1){const ee=ne(o,P,v);k[v]?k[v].p(ee,Y):(k[v]=ie(ee),k[v].c(),k[v].m(H,null))}for(;v<k.length;v+=1)k[v].d(1);k.length=P.length}Y&8&&h!==(h=(o[3]||"Select a mapping file")+"")&&J(y,h),o[3]?F||(F=re(),F.c(),F.m(a,null)):F&&(F.d(1),F=null),o[3]?L?L.p(o,Y):(L=oe(o),L.c(),L.m(R,null)):L&&(L.d(1),L=null),B===(B=$(o))&&E?E.p(o,Y):(E.d(1),E=B(o),E&&(E.c(),E.m(N,null)))},d(o){o&&A(t),w&&w.d(),S&&S.d(),he(k,o),F&&F.d(),L&&L.d(),E.d(),K=!1,Z()}}}function Ae(l){var r;let t,e,n;return e=new xe({props:{user:(r=l[0])==null?void 0:r.user,$$slots:{default:[Le]},$$scope:{ctx:l}}}),{c(){t=T(),_e(e.$$.fragment),document.title="Mapping Editor"},m(s,p){C(s,t,p),be(e,s,p),n=!0},p(s,[p]){var b;const d={};p&1&&(d.user=(b=s[0])==null?void 0:b.user),p&8388862&&(d.$$scope={dirty:p,ctx:s}),e.$set(d)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){me(e.$$.fragment,s),n=!1},d(s){s&&A(t),ce(e,s)}}}function Ce(l,t,e){let{auth:n=null}=t,{mappingFile:r=null}=t,{mappingContent:s=""}=t,{availableMappings:p=[]}=t,{errors:d={}}=t,{flash:b={}}=t,m=s,_=r,c=!1,M=!1,g=null,q=null;async function O(a){var x,h;e(4,c=!0),e(6,g=null);try{const y=await G.get(`/mappings/${a}`);e(2,m=y.data.content||""),e(3,_=a)}catch(y){e(6,g=((h=(x=y.response)==null?void 0:x.data)==null?void 0:h.message)||"Failed to load mapping file"),console.error("Load mapping error:",y)}finally{e(4,c=!1)}}async function H(){var a,x,h;if(!_){e(6,g="Please select a mapping file");return}e(5,M=!0),e(6,g=null),e(7,q=null);try{await G.put(`/mappings/${_}`,{content:m}),e(7,q="Mapping file saved successfully"),setTimeout(()=>{e(7,q=null)},3e3)}catch(y){((a=y.response)==null?void 0:a.status)===422&&y.response.data.errors,e(6,g=((h=(x=y.response)==null?void 0:x.data)==null?void 0:h.message)||"Failed to save mapping file"),console.error("Save mapping error:",y)}finally{e(5,M=!1)}}function W(){try{return m.trim()?!m.includes("fields:")&&!m.includes("target:")?(e(6,g="Invalid YAML structure: missing required fields"),!1):!0:(e(6,g="Mapping content cannot be empty"),!1)}catch(a){return e(6,g="YAML validation failed: "+a.message),!1}}async function j(){var x,h;const a=prompt("Enter mapping file name (e.g., product-to-sap.yaml):");if(!a||!a.endsWith(".yaml")){e(6,g="Invalid file name. Must end with .yaml");return}e(4,c=!0),e(6,g=null);try{const y=await G.post("/mappings",{filename:a,content:`target: ${a.replace(".yaml","")}

fields:
  # Add your field mappings here
`});e(3,_=a),e(2,m=y.data.content||""),ve.reload({only:["availableMappings"]})}catch(y){e(6,g=((h=(x=y.response)==null?void 0:x.data)==null?void 0:h.message)||"Failed to create mapping file"),console.error("Create mapping error:",y)}finally{e(4,c=!1)}}async function D(){var a,x;if(!_){e(6,g="Please select a mapping file");return}if(W()){e(4,c=!0),e(6,g=null);try{const h={order_number:"ORD-001",order_date:"2024-01-15",total_amount:1250.5,currency:"USD"},y=await G.post("/mappings/test",{mapping_file:_,test_data:h});alert(`Transformation Result:

`+JSON.stringify(y.data.result,null,2))}catch(h){e(6,g=((x=(a=h.response)==null?void 0:a.data)==null?void 0:x.message)||"Mapping test failed"),console.error("Test mapping error:",h)}finally{e(4,c=!1)}}}ye(()=>{r&&s&&(e(3,_=r),e(2,m=s))});const N=a=>O(a);function U(){m=this.value,e(2,m)}return l.$$set=a=>{"auth"in a&&e(0,n=a.auth),"mappingFile"in a&&e(12,r=a.mappingFile),"mappingContent"in a&&e(13,s=a.mappingContent),"availableMappings"in a&&e(1,p=a.availableMappings),"errors"in a&&e(14,d=a.errors),"flash"in a&&e(15,b=a.flash)},[n,p,m,_,c,M,g,q,O,H,j,D,r,s,d,b,N,U]}class Ye extends fe{constructor(t){super(),de(this,t,Ce,Ae,pe,{auth:0,mappingFile:12,mappingContent:13,availableMappings:1,errors:14,flash:15})}}export{Ye as default};
