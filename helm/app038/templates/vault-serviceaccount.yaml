{{- if .Values.vault.enabled }}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ include "app038.fullname" . }}-vault
  namespace: {{ .Values.namespace | default "default" }}
  labels:
    {{- include "app038.labels" . | nindent 4 }}
    app.kubernetes.io/component: vault
  annotations:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: "laravel-app"
    vault.hashicorp.com/agent-inject-secret-database: "database/creds/app038-readwrite"
    vault.hashicorp.com/agent-inject-template-database: |
      {{- `{{- with secret "database/creds/app038-readwrite" -}}
      export DB_USERNAME="{{ .Data.username }}"
      export DB_PASSWORD="{{ .Data.password }}"
      {{- end }}` | nindent 6 }}
    vault.hashicorp.com/agent-inject-secret-app-secrets: "secret/data/app038"
    vault.hashicorp.com/agent-inject-template-app-secrets: |
      {{- `{{- range $key, $value := .Data.data }}
      export {{ $key | upper }}="{{ $value }}"
      {{- end }}` | nindent 6 }}
{{- end }}

